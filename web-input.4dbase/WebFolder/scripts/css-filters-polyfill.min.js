var polyfilter_scriptpath="/scripts/";(function(a){var b={_ie:function(){var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");while(c.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->",d[0]);return b>4?b:a}(),_svg_cache:{},_create_svg_element:function(a,b){var c="http://www.w3.org/2000/svg",d=document.createElementNS(c,a);for(key in b)d.setAttributeNS(null,key,b[key]);return d},_create_svg:function(a,b){var c="http://www.w3.org/2000/svg",d=document.createElementNS(c,"svg");d.setAttributeNS(null,"width","0"),d.setAttributeNS(null,"height","0"),d.setAttributeNS(null,"style","position:absolute");var e=document.createElementNS(c,"filter");e.setAttributeNS(null,"id",a),d.appendChild(e);for(var f=0;f<b.length;f++)e.appendChild(b[f]);return d},_pending_stylesheets:0,_stylesheets:[],_development_mode:function(){if(location.hostname==="localhost"||location.hostname.search(/.local$/)!==-1||location.hostname.search(/\d+\.\d+\.\d+\.\d+/)!==-1)if(a.console)return!0;if(a.console)return!1}(),process_stylesheets:function(){var c=[];a.setTimeout(function(){if(a.XMLHttpRequest)var b=new XMLHttpRequest;else if(a.ActiveXObject)var b=new ActiveXObject("Microsoft.XMLHTTP");b.open("GET",a.polyfilter_scriptpath+"htc/sepia.htc",!0),b.onreadystatechange=function(){c.readyState==4&&c.status!=200&&alert('The configured path \r\rvar polyfilter_scriptpath = "'+a.polyfilter_scriptpath+'"\r\rseems wrong!\r\rConfigure the polyfill\'s correct absolute(!) script path before referencing the css-filters-polyfill.js, like so:\r\rvar polyfilter_scriptpath = "/js/css-filters-polyfill/";\r\rLeaving IE dead in the water is no option. You damn Mac user... ;)')};try{b.send(null)}catch(d){}},2e3);var d=document.querySelectorAll?document.querySelectorAll('style,link[rel="stylesheet"]'):document.getElementsByTagName("*");for(var e=0;e<d.length;e++)(function(c){switch(d[c].nodeName){default:break;case"STYLE":b._stylesheets.push({media:d[c].media||"all",content:d[c].innerHTML});break;case"LINK":if(d[c].rel==="stylesheet"){var e=b._stylesheets.length;b._stylesheets.push({media:d[c].media||"all"}),b._pending_stylesheets++;var f=d[c].href;!b._development_mode&&a.localStorage&&a.localStorage.getItem("polyfilter_"+f)&&(b._pending_stylesheets--,b._stylesheets[e].content=localStorage.getItem("polyfilter_"+f),b._pending_stylesheets===0&&b.process());try{if(a.XMLHttpRequest)var g=new XMLHttpRequest;else if(a.ActiveXObject)var g=new ActiveXObject("Microsoft.XMLHTTP");g.open("GET",f,!0),g.onreadystatechange=function(){if(g.readyState===4)if(g.status===0)a.console&&console.log("Could not fetch external CSS via HTTP-Request "+f+". Probably because of cross origin."),b._stylesheets[e].content||(b._pending_stylesheets--,b._stylesheets[e].content=g.responseText,b._pending_stylesheets===0&&b.process());else{b._stylesheets[e].content||(b._pending_stylesheets--,b._stylesheets[e].content=g.responseText,b._pending_stylesheets===0&&b.process());if(!b._development_mode&&a.localStorage)try{a.localStorage.setItem("polyfilter_"+f,b._stylesheets[e].content)}catch(c){a.console&&console.log("Local storage quota have been exceeded. Caching of stylesheet "+f+" is not possible")}}};try{g.send(null)}catch(h){a.console&&console.log("Could not fetch external CSS via HTTP-Request "+f+". Are you maybe testing using the file://-protocol?"),b._stylesheets[e].content||(b._pending_stylesheets--,b._pending_stylesheets===0&&b.process())}}catch(h){}}}})(e);this._pending_stylesheets===0&&this.process()},_processDeclarations:function(a){var c="";for(var d in a.declarations){var e=a.declarations[d];if(e.property==="filter"){if(document.querySelectorAll){var f=document.querySelectorAll(a.mSelectorText);for(var d=0;d<f.length;d++)f[d].style.polyfilterStore=e.valueText}var g=e.valueText,h=g.split(/\)\s+/),i={filtersW3C:[],filtersWebKit:[],filtersSVG:[],filtersIE:[],behaviorsIE:[]};for(idx in h){var j=h[idx]+")";currentproperties=b.convert(j);for(key in currentproperties)typeof i[key]!="undefined"&&(i[key]=i[key].concat(currentproperties[key]))}c+=a.mSelectorText+"{";if(i.filtersW3C.length>0){var k=webkitFilter=mozFilter=oFilter=msFilter=i.filtersW3C.join(" ");i.filtersWebKit&&i.filtersWebKit.length>0&&(webkitFilter=i.filtersWebKit.join(" ")),typeof this._ie=="undefined"&&(c+="-ms-filter:"+msFilter+";"),c+="-webkit-filter:"+webkitFilter+";",c+="-moz-filter:"+mozFilter+";",c+="-o-filter:"+oFilter+";"}if(i.filtersSVG.length>0)if(i["filtersSVG"][0]!="none"){var l=g.replace(/[^a-z0-9]/g,"");if(typeof this._svg_cache[l]=="undefined"){this._svg_cache[l]=this._create_svg(l,i.filtersSVG);if(typeof XMLSerializer=="undefined")document.body.appendChild(this._svg_cache[l]);else{var m=new XMLSerializer,n=m.serializeToString(this._svg_cache[l]);n.search("SourceGraphic")!=-1&&document.body.appendChild(this._svg_cache[l])}}if(typeof XMLSerializer=="undefined")c+="filter: url(#"+l+")";else{var m=new XMLSerializer,n=m.serializeToString(this._svg_cache[l]);n.search("SourceGraphic")!=-1?c+="filter: url(#"+l+")":c+="filter: url('data:image/svg+xml;utf8,"+n+"#"+l+"')"}}else c+="filter: none;";if(typeof this._ie!="undefined"){if(i.filtersIE.length>0){var o=i.filtersIE.join(" ");c+="filter:"+o+";"}if(i.behaviorsIE.length>0){var p=i.behaviorsIE.join(" ");c+="behavior:"+p+";"}}c+="}\r\n"}}return c},scriptpath:a.polyfilter_scriptpath?a.polyfilter_scriptpath:function(){return alert('Please configure the polyfill\'s absolute(!) script path before referencing the css-filters-polyfill.js, like so:\r\nvar polyfilter_scriptpath = "/js/css-filters-polyfill/";'),"./"}(),process:function(){var a=new CSSParser;for(var c=0;c<this._stylesheets.length;c++){var d="",e=a.parse(this._stylesheets[c].content,!1,!0);if(e!==null)for(var f in e.cssRules){var g=e.cssRules[f];switch(g.type){default:break;case 1:d+=this._processDeclarations(g);break;case 4:d+="@media "+g.media.join(",")+"{";for(var h in g.cssRules){var i=g.cssRules[h];d+=this._processDeclarations(i)}d+="}"}}var j=document.createElement("style");j.setAttribute("media",this._stylesheets[c].media),typeof b._ie=="undefined"?(j.innerHTML=d,document.getElementsByTagName("head")[0].appendChild(j)):(document.getElementsByTagName("head")[0].appendChild(j),j.styleSheet.cssText=d)}},init:function(){Object.defineProperty&&Object.defineProperty(CSSStyleDeclaration.prototype,"polyfilter",{get:function(){return this.polyfilterStore},set:function(a){values=a.split(/\)\s+/);var c={filtersW3C:[],filtersWebKit:[],filtersSVG:[],filtersIE:[],behaviorsIE:[]};for(idx in values){var d=values[idx]+")";currentproperties=b.convert(d);for(key in currentproperties)typeof c[key]!="undefined"&&(c[key]=c[key].concat(currentproperties[key]))}c.filtersW3C.length>0&&(typeof b._ie=="undefined"&&(this.msFilter=c.filtersW3C.join(" ")),this.webkitFilter=this.mozFilter=this.oFilter=c.filtersW3C.join(" ")),c.filtersWebKit.length>0&&(this.webkitFilter=c.filtersWebKit.join(" "));if(c.filtersSVG.length>0)if(c["filtersSVG"][0]!="none"){var e=a.replace(/[^a-z0-9]/g,"");if(typeof b._svg_cache[e]=="undefined"){b._svg_cache[e]=b._create_svg(e,c.filtersSVG);if(typeof XMLSerializer=="undefined")document.body.appendChild(b._svg_cache[e]);else{var f=new XMLSerializer,g=f.serializeToString(b._svg_cache[e]);g.search("SourceGraphic")!=-1&&document.body.appendChild(b._svg_cache[e])}}if(typeof XMLSerializer=="undefined")this.filter="url(#"+e+")";else{var f=new XMLSerializer,g=f.serializeToString(b._svg_cache[e]);g.search("SourceGraphic")!=-1?this.filter="url(#"+e+")":this.filter="url('data:image/svg+xml;utf8,"+g+"#"+e+"')"}}else this.filter="none";typeof b._ie!="undefined"&&(c.filtersIE.length>0?this.filter=c.filtersIE.join(" "):this.filter="",c.behaviorsIE.length>0?this.behavior=c.behaviorsIE.join(" "):this.behavior=""),this.polyfilterStore=a}})},convert:function(a){var b=a.match(/none/i);if(b!==null)var c=this.filters.none();var b=a.match(/(grayscale)\(([0-9\.]+)\)/i);if(b!==null)var d=parseFloat(b[2],10),c=this.filters.grayscale(d);var b=a.match(/(sepia)\(([0-9\.]+)\)/i);if(b!==null)var d=parseFloat(b[2],10),c=this.filters.sepia(d);var b=a.match(/(blur)\(([0-9]+)[px]*\)/i);if(b!==null)var d=parseInt(b[2],10),c=this.filters.blur(d);var b=a.match(/(invert)\(([0-9\.]+)\)/i);if(b!==null)var d=parseFloat(b[2],10),c=this.filters.invert(d);var b=a.match(/(brightness)\(([0-9\.]+)%\)/i);if(b!==null)var d=parseFloat(b[2],10),c=this.filters.brightness(d);var b=a.match(/(drop\-shadow)\(([0-9]+)[px]*\s+([0-9]+)[px]*\s+([0-9]+)[px]*\s+([#0-9]+)\)/i);if(b!==null)var e=parseInt(b[2],10),f=parseInt(b[3],10),g=parseInt(b[4],10),h=b[5],c=this.filters.dropShadow(e,f,g,h);return c},filters:{none:function(){var a={};return typeof b._ie=="undefined"?(a.filtersW3C=["none"],a.filtersSVG=["none"]):a.filtersIE=["none"],a},grayscale:function(a){a=a||0;var c={};if(typeof b._ie=="undefined"){c.filtersW3C=["grayscale("+a+")"];var d=b._create_svg_element("feColorMatrix",{type:"matrix",values:.2126+.7874*(1-a)+" "+(.7152-.7152*(1-a))+" "+(.0722-.0722*(1-a))+" 0 0 "+(.2126-.2126*(1-a))+" "+(.7152+.2848*(1-a))+" "+(.0722-.0722*(1-a))+" 0 0 "+(.2126-.2126*(1-a))+" "+(.7152-.7152*(1-a))+" "+(.0722+.9278*(1-a))+" 0 0 0 0 0 1 0"});c.filtersSVG=[d]}else c.filtersIE=a>=.5?["gray"]:[];return c},sepia:function(a){a=a||0;var c={};if(typeof b._ie=="undefined"){c.filtersW3C=["sepia("+a+")"];var d=b._create_svg_element("feColorMatrix",{type:"matrix",values:.393+.607*(1-a)+" "+(.769-.769*(1-a))+" "+(.189-.189*(1-a))+" 0 0 "+(.349-.349*(1-a))+" "+(.686+.314*(1-a))+" "+(.168-.168*(1-a))+" 0 0 "+(.272-.272*(1-a))+" "+(.534-.534*(1-a))+" "+(.131+.869*(1-a))+" 0 0 0 0 0 1 0"});c.filtersSVG=[d]}else c.filtersIE=a>=.5?["gray","progid:DXImageTransform.Microsoft.Light()"]:[],c.behaviorsIE=a>=.5?['url("'+b.scriptpath+'htc/sepia.htc")']:[];return c},blur:function(a){a=Math.round(a)||0;var c={};if(typeof b._ie=="undefined"){c.filtersW3C=["blur("+a+"px)"];var d=b._create_svg_element("feGaussianBlur",{"in":"SourceGraphic",stdDeviation:a});c.filtersSVG=[d]}else c.filtersIE=["progid:DXImageTransform.Microsoft.Blur(pixelradius="+a+")"];return c},invert:function(a){a=a||0;var c={};if(typeof b._ie=="undefined"){c.filtersW3C=["invert("+a+")"];var d=b._create_svg_element("feComponentTransfer",{}),e=b._create_svg_element("feFuncR",{type:"table",tableValues:a+" "+(1-a)});d.appendChild(e);var e=b._create_svg_element("feFuncG",{type:"table",tableValues:a+" "+(1-a)});d.appendChild(e);var e=b._create_svg_element("feFuncB",{type:"table",tableValues:a+" "+(1-a)});d.appendChild(e),c.filtersSVG=[d]}else c.filtersIE=a>=.5?["invert"]:[];return c},brightness:function(a){a=a||0;var c={};if(typeof b._ie=="undefined"){c.filtersW3C=["brightness("+a+"%)"],c.filtersWebKit=["brightness("+(a-100)+"%)"];var d=b._create_svg_element("feComponentTransfer",{}),e=b._create_svg_element("feFuncR",{type:"linear",slope:a/100});d.appendChild(e);var e=b._create_svg_element("feFuncG",{type:"linear",slope:a/100});d.appendChild(e);var e=b._create_svg_element("feFuncB",{type:"linear",slope:a/100});d.appendChild(e),c.filtersSVG=[d]}else c.filtersIE=["progid:DXImageTransform.Microsoft.Light()"],c.behaviorsIE=['url("'+b.scriptpath+'htc/brightness.htc")'];return c},dropShadow:function(a,c,d,e){a=Math.round(a)||0,c=Math.round(c)||0,d=Math.round(d)||0,e=e||"#000000";var f={};if(typeof b._ie=="undefined"){f.filtersW3C=["drop-shadow("+a+"px "+c+"px "+d+"px "+e+")"];var g=b._create_svg_element("feGaussianBlur",{"in":"SourceAlpha",stdDeviation:d}),h=b._create_svg_element("feOffset",{dx:a+1,dy:c+1,result:"offsetblur"}),i=b._create_svg_element("feFlood",{"flood-color":e}),j=b._create_svg_element("feComposite",{in2:"offsetblur",operator:"in"}),k=b._create_svg_element("feMerge",{}),l=b._create_svg_element("feMergeNode",{});k.appendChild(l);var l=b._create_svg_element("feMergeNode",{"in":"SourceGraphic"});k.appendChild(l),f.filtersSVG=[g,h,i,j,k]}else f.filtersIE=["progid:DXImageTransform.Microsoft.Glow(color="+e+",strength=0)","progid:DXImageTransform.Microsoft.Shadow(color="+e+",strength=0)"],f.behaviorsIE=['url("'+b.scriptpath+'htc/drop-shadow.htc")'];return f}}};a.jQuery?a.jQuery(document).ready(function(a){b.process_stylesheets()}):a.contentLoaded?contentLoaded(a,function(){b.process_stylesheets()}):a.addEventListener?document.addEventListener("DOMContentLoaded",function(){b.process_stylesheets()},!1):a.attachEvent&&a.attachEvent("onload",function(){b.process_stylesheets()}),b.init()})(window)